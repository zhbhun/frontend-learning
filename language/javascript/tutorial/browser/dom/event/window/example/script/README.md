## 示例分析

示例输出结果：

```
3030 'loading'
3039.7999999970198 'async1'
4042.60000000149 'default'
4043.10000000149 'interactive'
4043.2000000029802 'defer'
4043.2999999970198 'DOMContentLoaded'
6068.10000000149 'async'
6068.29999999702 'complete'
```

总结：浏览器加载样式和脚本的机制

1. 解析 HTML；

    `document.readyState` 处于 `loading` 状态；

2. 遇到外链样式文件，浏览器需要等待样式文件加载完后才会渲染；

    ps：避免闪烁

3. 遇到内联脚本，需要等待外链样式文件加载完成后才会执行；

    - 外链样式文件加载完成

4. 遇到外链阻塞脚本，立即下载并阻塞后续的 HTML 渲染，并且会等待外链样式和前置外链阻塞脚本加载完成会再执行；

    - 外链样式加载完成
    - 前置的外链延迟脚本加载完

    ps：会阻塞渲染，但后续的脚本会预解析加载，外链阻塞脚本都执行完成后就会触发 readystatechange 事件，`document.readyState` 转变为 `interactive` 状态；

5. 遇到外链异步脚本，立即下载并不阻塞后续的 HTML 渲染，并且会等待外链样式加载完成会再执行；

    - 外链样式加载完成

    ps：异步脚本下载完就执行，而不受阻塞脚本的影响，前提是外链样式加载完成。

6. 遇到外链延迟脚本，立即下载并不阻塞后续的 HTML 渲染，并且会等待外链样式、外链阻塞脚本和前置的外链延迟脚本加载完成后再执行；

    - 外链样式加载完
    - 外链阻塞脚本加载完
    - 前置的外链延迟脚本加载完

ps：所有的静态资源加载完成后会触发 load 事件，`document.readyState` 转变为 `complete` 状态。

## 脚本加载机制

| 特性/脚本 | 同步 | 异步 | 延迟 |
| --- | --- | --- | --- |
| 受外链样式阻塞 | 是 | 是 | 是 |
| 受前置外链脚本阻塞 | 仅限外链同步脚本 | 否 | 仅限外链同步和延迟脚本 |
| 阻塞后续 HTML 渲染 | 是 | 否 | 否 |
| 对应事件 | 执行完后触发 `readystatechange(interactive)` | 可能影响 `load` 事件 | 执行完后出发 `DOMContentLoaded` 事件 |

## 问题

### 代码里动态的插入外链样式是否阻塞渲染和脚本执行

不会，参考示例 `./async-style.html`

### 在 DOMContentLoaded 事件里注入静态资源是否影响 load

会，如果进行延迟的话不会。

ps：load 事件是移动端注入 JSBridge 的时机。
