要点

- 排版系统

    - AntV：基于 Facebook 开源的 Yoga 排版引擎
    - SpriteJS：？
    - Hippy：自己实现了一套类似 Yoga 的排版引擎，叫做 Titank。
    - 飞书：排版语法更加接近于 Flutter，实现了 Padding、Column、Row、Margin、Expanded、Flex、GridView 等 Widget。

- 虚拟节点

    目前主流的 Canvas 渲染引擎都会将要绘制的图形封装成类，以方便开发者去调用，复用性也比较强。调用方式类似于 DOM，每个实例可以当做一个虚拟节点。

- 包围盒

    既然有了虚拟节点，那知道每个虚拟节点的位置和大小也比较重要，它会涉及到判断两个图形是否相交、事件等等。有时候元素的形状不是很规则，如果直接对不规则元素进行碰撞检测会比较麻烦，所以就有了一个近似的算法，就是在物体外侧加上包围盒，目前主流的包围盒有 AABB 和 OBB 两种。

    - AABB 包围盒：实现方式简单，直接用最大最小的横纵坐标来生成包围盒，但不会跟着元素旋转，因此空白区域比较多，也不够准确。
    - OBB 包围盒：实现方式相对复杂，通过构建协方差矩阵来计算出新的坐标轴方向，将其顶点投射到坐标轴上面来得到新的包围盒。所以 OBB 包围盒更加准确一些，也是 cocos2d 使用的方式。

- 碰撞检测

    两个包围盒在所有轴（与边平行）上的投影都发生重叠，则判定为碰撞；否则，没有发生碰撞。

- 事件机制

    - 取色值法
    - 几何法

- 性能优化

    - 离屏渲染
    - 脏区渲染
    - 异步批量渲染

## 参考文献

- [浅谈 Canvas 渲染引擎](https://zhuanlan.zhihu.com/p/608415829)
