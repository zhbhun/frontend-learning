(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.openNewsapp=global.openNewsapp||{})})(this,function(exports){"use strict";var ua=window.navigator.userAgent;var isQQ=/QQ/i.test(ua)&&!/MQQBrowser/i.test(ua);var isWechat=/MicroMessenger/i.test(ua);var isQzone=/Qzone/i.test(ua);var isWeibo=/weibo/i.test(ua);var isBaidu=/baidu/i.test(ua);var isOpr=/OPR/i.test(ua);var isSogou=/Sogou/i.test(ua);var isUc=/UCBrowser/i.test(ua);var isFirefox=/Firefox/i.test(ua);var isSamsung=/SamsungBrowser/i.test(ua);var isAndroid=/android/i.test(ua);var isIOS=/iphone|ipad|ipd/i.test(ua);var NEWS_TYPES=[{type:"startup",reg:"^startup",scheme:"startup"},{type:"web",reg:"^https?",scheme:"web/{{param}}"},{type:"article",reg:"^[A-Z0-9]{16}$",scheme:"doc/{{param}}"},{type:"special",reg:"^S[0-9]{13}$",scheme:"topic/{{param}}"},{type:"photo",reg:"^\\d{4}\\/\\d{1,}",scheme:"photo/{{param}}"},{type:"live",reg:"^live\\/\\d{1,}",scheme:"{{param}}"},{type:"video",reg:"^V",scheme:"video/{{param}}"},{type:"reader",reg:"^reader",scheme:"{{param}}"},{type:"channel",reg:"^channel",scheme:"{{param}}"},{type:"tie",reg:"^tie",scheme:"{{param}}"},{type:"expert",reg:"^EX-?[0-9]+",scheme:"expert/{{param}}"},{type:"subject",reg:"^SJ[0-9]+",scheme:"subject/{{param}}"},{type:"luobo",reg:"^luobo\\/[0-9]+",scheme:"{{param}}/1"},{type:"book",reg:"^book\\/",scheme:"{{param}}"}];var DOWNLOAD_URLS={iOS:"https://itunes.apple.com/app/apple-store/id425349261?pt=104792803&ct=huiliu_8&mt=8",android:"http://3g.163.com/links/7263?s={CHANNLE}",winPhone:"http://3g.163.com/links/3614?s={CHANNLE}"};var configs=[];function getConfig(channel){return configs.filter(function(item){return item.type===channel})[0]||{}}function getNewsType(param){return NEWS_TYPES.filter(function(t){return new RegExp(t.reg).test(param)})[0]||NEWS_TYPES[0]}function getIframe(){var ifr=document.getElementById("open_newsapp_iframe");if(ifr){return ifr}var iframe=document.createElement("iframe");iframe.id="open_newsapp_iframe";iframe.style.display="none";document.body.appendChild(iframe);return iframe}function jsonp(a,b,c){var d=document.createElement("script");d.src=a;d.charset=c||"utf-8";d.onload=function(){d.onload=null;d.onerror=null;d.parentNode.removeChild(d);b&&b(!0)};d.onerror=function(){d.onload=null;d.onerror=null;d.parentNode.removeChild(d);b&&b(!1)};document.head.appendChild(d)}jsonp("//active.163.com/service/form/v1/5847/view/1047.jsonp?ignoreMaxSize=true&pageSize=500&callback=channelConfig");window.channelConfig=function(data){window.channelConfig=null;configs=data.list};function getScheme(param){var news=getNewsType(param);return news.scheme.replace("{{param}}",news.type==="web"?encodeURIComponent(param):param)}function open(_ref){var param=_ref.param,_ref$download=_ref.download,download=_ref$download===undefined?false:_ref$download,_ref$channel=_ref.channel,channel=_ref$channel===undefined?"sps":_ref$channel,_ref$redirect=_ref.redirect,redirect=_ref$redirect===undefined?"":_ref$redirect;var scheme=getScheme(param);var config=getConfig(channel);window.neteaseTracker&&window.neteaseTracker(false,"http://sps.163.com/func/?func=module_all_"+channel,"","sps");if(download){setTimeout(function(){if(isIOS){window.location.href=DOWNLOAD_URLS.iOS}else if(isAndroid){window.location.href=DOWNLOAD_URLS.android.replace("{CHANNLE}",channel)}else{window.location.href=DOWNLOAD_URLS.winPhone.replace("{CHANNLE}",channel)}},100);return}if(redirect){if(isAndroid){var iframe=getIframe();iframe.src="newsapp://"+scheme+"?s="+channel;setTimeout(function(){window.location.href=redirect},120)}else{setTimeout(function(){window.location.href="http://m.163.com/newsapp/applinks.html?path="+encodeURIComponent("/"+scheme)+"&s=sps_ulink&ss="+channel+"&redirect="+redirect},100)}}if(!isAndroid||isWeibo){setTimeout(function(){window.location.href="http://m.163.com/newsapp/applinks.html?path="+encodeURIComponent("/"+scheme)+"&s=sps_ulink&ss="+channel},100);return}if(isWechat){setTimeout(function(){window.location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.netease.newsreader.activity&ckey="+(config.tencent||"CK1331205846719")+"&android_schema=newsapp://"+scheme+"?s="+channel},100);return}setTimeout(function(){var iframe=getIframe();iframe.src="newsapp://"+scheme+"?s="+channel},100);if(isWechat||isQzone||isWeibo||isBaidu||isOpr||isSogou||isUc||isFirefox||isSamsung){setTimeout(function(){if(document.hidden||document.webkitHidden)return;window.location.href=config.android||"http://3g.163.com/links/7263?s="+channel},100)}else{setTimeout(function(){var toastWrap=document.querySelector(".toast-wrap");var deviceW=document.body.clientWidth;var w=deviceW*585/1125;if(!toastWrap){document.body.insertAdjacentHTML("beforeend",'\n          <div class="shadow-box" style="width: 100%;height: 100%;position: fixed;z-index:99999998;left: 0;top: 0;background: rgba(0,0,0,0.6);"></div>\n          <div class="toast-wrap" style="position:fixed;z-index:99999999;left:0;width:100%;background: url(http://img6.cache.netease.com/utf8/3g/touch/images/toast-download.png) top center no-repeat;background-size:cover;transform: translateY(0px);-webkit-transform: translateY(0px);transition:transform .2s ease-in-out;-webkit-transition:-webkit-transform .2s ease-in-out;">\n            <span class="toast-close" style="float:right;width:40px;height:40px;"></span>\n            <div class="toast-btn" style="margin: 0 auto;width:100%;"></div>\n          </div>\n        ');window.neteaseTracker&&window.neteaseTracker(false,"http://sps.163.com/func/?func=module_layer_show_"+channel,"","sps");toastWrap=document.querySelector(".toast-wrap");var toastClose=document.querySelector(".toast-close");var toastBtn=document.querySelector(".toast-btn");toastWrap.style.height=w+"px";toastWrap.style.bottom=-w+"px";toastBtn.style.width=deviceW*(1042/1125)+"px";toastBtn.style.height=w*(140/585)+"px";toastBtn.style.marginTop=w*(360/585)+"px";toastWrap.style.webkitTransform="translateY(-"+w+"px)";toastWrap.style.transform="translateY(-"+w+"px)"}else{if(toastWrap.style.transform==="translateY(0px)"){document.querySelector(".shadow-box").style.display="block";toastWrap.style.webkitTransform="translateY(-"+w+"px)";toastWrap.style.transform="translateY(-"+w+"px)"}}toastWrap.addEventListener("click",function(e){var classlist=e.target.classList;function hideToast(){toastWrap.style.transform="translateY(0px)";toastWrap.style.webkitTransform="translateY(0px)";toastWrap.style.transition="transform .2s ease-in-out";toastWrap.style.webkitTransition="-webkit-transform .2s ease-in-out";document.querySelector(".shadow-box").style.display="none"}if(classlist.contains("toast-close")){window.neteaseTracker&&window.neteaseTracker(false,"http://sps.163.com/func/?func=module_layer_close_"+channel,"","sps");hideToast()}else if(classlist.contains("toast-btn")){window.neteaseTracker&&window.neteaseTracker(false,"http://sps.163.com/func/?func=module_layer_download_"+channel,"","sps");setTimeout(function(){if(document.hidden||document.webkitHidden)return;hideToast();window.location.href=config.android||"http://3g.163.com/links/7263?s="+channel},100)}})},300)}}exports.getScheme=getScheme;exports.open=open;Object.defineProperty(exports,"__esModule",{value:true})});