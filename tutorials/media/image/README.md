# 图片

| 类型 | Alpha 通道 | 动画 | 编解码性能 | 压缩算法 | 颜色支持 | 兼容性 |
| --- | --- | --- | --- | --- | --- | --- |
| Gif | 支持 | 支持 | 较高 | 无损压缩 | 索引色(256) | 好 |
| PNG-8/PNG-24 | 支持 | 不支持 | 较高 | 无损压缩 | 索引色(256) / 直接色 | 好 |
| JPEG | 不支持 | 不支持 | 较高 | 有损压缩 | 直接色 | 好 |
| WebP | 支持 | 支持 | 较差 | 有损/无损压缩 | 直接色 | 一般 |
| AVIF | 支持 | 支持 | 渐进式解码 | 有损/无损压缩 | 直接色 | 差 |
| JPEG XL | 支持 | 支持 | 一般 | 有损/无损压缩 | 直接色 | 非常差 |

## 渐进式渲染

- [图片渐进加载优化](https://juejin.cn/post/7016317182766383141)
- [medium.com 是如何让图片加载时从模糊到清晰的？](https://www.zhihu.com/question/40757342)
- [mozjpeg](https://github.com/mozilla/mozjpeg)
- [imagemin-mozjpeg](https://github.com/imagemin/imagemin-mozjpeg)
- [mozjpeg-bin](https://github.com/imagemin/mozjpeg-bin)
- [interlace-png-with-Adam7](https://github.com/chenzeze/interlace-png-with-Adam7)

## 最佳实践

1. 初始化设置

  - 响应式资源：图片格式、图片分辨率等；
  - 透明度为 0：避免出现加载过程的从上到下逐步渲染显示的效果；
  - 懒加载计算：根据图片是否滑动到屏幕内来判定是否渲染图片；

2. 加载过渡

  - 加载中：图片默认的加载效果通常是从上到下的显示，一般会改成一个灰底的占位图；
  - 加载失败：提供失败提示或者保持加载占位图效果；
  - 渐变转换：从占位图切换到真实图片时需要设置个过渡动画，显示效果更佳的丝滑；
  - 缓存试探：延迟 100ms 再将图片透明度设为 1，如果图片加载成功说明图片又缓存或者非常小，这时候没必要显示一个灰色占位，避免屏幕闪烁。

3. 失败重试：如果发现是网络问题导致的加载失败，可以在后台尝试自动的加载重试。
4. 预加载优化：使用 link preload 来实现预加载，以避免图片阻塞网络的 onload 事件，导致移动端 JS Bridge 注入时机推后。

## 参考文献

- [现代图片性能优化及体验优化指南 - 图片类型及 Picture 标签的使用](https://juejin.cn/post/7198182873366888509)
