# 页面可视化搭建

## 功能结构

- 

- 

### 组件状态

| 特性/竞品 | plasmic | webflow | 稿定 |
| --------- | ------- | ------- | ---- |
| 悬浮状态  | ✓       | ✓       | ✗    |
| 聚焦状态  | ✓       | ✓       | ✗    |
| 按压状态  | ✓       | ✓       | ✗    |

### 定制组件

- plasmic：可以
- webflow：可以
- 稿定“：不支持

### 图片管理

| 特性/竞品 | plasmic | webflow | 稿定 |
| --------- | ------- | ------- | ---- |
| 图片管理  | ✓       | ✓       | ✓    |
| 批量上传  | ✗       | ✓       | ✓    |
| 后台上传  | ✗       | ✓       | ✓    |
| 图片分组  | ✗       | ✓       | ✓    |
| 链接图片  | ✓       | ✗       | ✗    |
| 依赖分析  | ✓       | ✗       | ✗    |

## 技术要点

### DSL

存在问题：

1. 如何解决 DSL 版本兼容问题
2. 如何解决数据膨胀问题
   一个站点可能存在多个页面，如果数据较多，每次都要全量保存和下发，比较影响性能。
1. ...

### BOM

BOM：Batman Object Model，是 DSL 的编程接口，提供了对 DSL 的结构化的表述，并定义了一种方式可以使从程序中对该结构进行访问，从而改变 DSL 的结构，样式和内容。

#### 生命周期

- node: beforeCreate => create => created => insertion =》 mounted =》unmounted
- ...

参考

- 小程序：onLoad =》onShow =》onReady =》onHide =》onShow =》onUnload
- vue：beforeCreate =》created =》beforeMount =》 mount =》 beforeUpdate =》 updated =》 beforeDestroy =》 destroy



### 画布

#### 滚动模式

内部滚动 vs 外部滚动

- 内部滚动：在 tmagic 中出现，编辑体验较差，但可以较为真实的模拟设备，实现固定定位效果较为容易
- 外部滚动：大部分采用该方案，编辑交互体验较好，但在实现固定定位等需要模拟真实设备的场景时较为麻烦

#### 缩放模式

整体放大 VS 单独组件放大

- 整体放大：易企秀、tmagic 等，实现较为简单，但需要解决可视化控制器（拖拽和放大等元素）的跟随放大问题
  ps：tmagic 组件画布使用 transform scale 缩放，拖拽和放大缩小器放在蒙层处理。
- 单独组件放大：稿定设计等，避免可视化控制器跟随放大，但实现较为麻烦，而且嵌套子组件也会跟随放大，无法解决嵌套子组件的放大问题

#### 组件元素交互和编辑

如何屏蔽组件元素在编辑模式的交互功能，并开启编辑能力。

- 事件捕获
- css point-events
- 全局蒙层遮挡

  可以比较容易解决编辑模式的高亮线框和控制器的层级问题（不会因为嵌套组件被其他组件折叠时，编辑交互辅助显示被遮挡问题）。

  但是蒙层模式比较难以解决嵌套组件存在变形样式的模拟问题，例如遇到目标组件父级存在旋转时，蒙层中的镜像节点难以模拟。虽然可以在蒙层模拟渲染各个层，但是遇到一些定制组件时，还是会存在问题。

- 事件捕获 + 局部蒙层遮挡 + 全局蒙层拖拽控制器

  - 在根节点通过事件捕获拦截所有事件

    为什么不在组件上设置局部的遮挡层来屏蔽事件？ —— 主要是由于存在子组件，蒙层会把子组件一起遮挡了

  - ***

  是用类似 moveable 的组件，目标设置在真实组件的遮挡层，而拖拽控制器的容器设置在全局蒙层上。

  问题：拖拽控制可能真实组件的层级影响（可以通过 elementsFromPoint 来获取当前选中的组件，来解决层级问题）。

  总结：既可以复用渲染组件的布局，又能解决拖拽控制器被遮挡问题

### 组件

#### 布局组件

争议点：自由布局 VS 流式布局

- 设计风格：不支持嵌套组件，但支持元素分组，在稿定、figama 等偏设计类的工具使用；
- 网站风格：支持嵌套组件，但是拖拽体验较差，需要较为熟悉前端 CSS 知识，自行配置样式熟悉来实现各种布局，在 webflow、阿里低代码引擎等站点编辑器上较为常见；

| 方式/竞品 | plasmic | webflow | 稿定 |
| --------- | ------- | ------- | ---- |
| 自由布局  | ✓       | ✗       | ✗    |
| 流式布局  | ✗       | ✓       | ✗    |
| 弹性布局  | ✓       | ✓       | ✗    |
| 网格布局  | ✓       | ✓       | ✗    |

细节问题

- 布局切换：关注切换后的子组件位置和大小
  - plasmic：
    - 自由布局 =》非自由布局：重置子组件的位置样式
    - 非自由布局 =》自由布局：保留非自由布局的坐标位置
  - webflow：不支持自由布局，所以没有该问题
  - 稿定：不支持
- 子组件拖拽容易误拖拽到别的容器里
  市面上的编辑器暂时没有看到比较好的解决方案，是否可以考虑配合快捷键来实现，比如按住 shift 键表示拖拽组件始终在目标容器里，或者反转下：默认是在同级变动，需要按住 shift 或 command 键盘，才能脱出容器。
- ...

#### 远程组件加载

要支持动态注册，存在问题

1. 如何解决组件公共库提取问题？

2. 如何解决组件版本兼容问题？

   

- [低代码平台远程组件加载的多种方案](https://mp.weixin.qq.com/s?__biz=MzI2MjcxNTQ0Nw==&mid=2247500403&idx=1&sn=3470062142a9ad0ddbece75e915a1a5e&chksm=ea44632bdd33ea3d82074a59cfb0388e45e02cda07719672e4db40fd6d31a235b3e294732d78&mpshare=1&scene=1&srcid=0803kipweJuMt6e0ytTBVegH&sharer_sharetime=1659502754360&sharer_shareid=23bfc8f6684b676886641da1cfece5af&version=4.0.2.90474&platform=mac#rd)

#### 自定义组件

竞品分析

| 方式/竞品                      | plasmic                         | webflow | figma                  |
| ------------------------------ | ------------------------------- | ------- | ---------------------- |
| 自定义组件                     | ✓                               | ✓       | ✓                      |
| 变体属性（大小、类型、状态等） | ✓                               | ✗       | ✓                      |
| 显隐藏子组件                   | ✓（需要使用变体属性，较为麻烦） | ✓       | ✓                      |
| 映射子组件属性                 | ✗                               | ✓       | ✓                      |
| 使用时定制子元素样式           | ✗                               | ✗       | 除了位置和大小外的样式 |

功能要点

- 管理
  - 组件列表
  - 添加组件：设定组件名称信息
  - 修改组件：设定组件名称等信息
  - 编辑组件：默认提供一个容器组件，且不能删除
    - 支持自定义变体属性：布尔、选择，自动在画布上呈现对应变体元素供开发者调整
    - 子组件支持添加是否显示的组件属性，即使不提供，使用时也可以自行选择子组件来隐藏（相对比来说，更直观和方便）
    - 子组件支持将属性映射到自定义组件属性上（）
  - 删除组件：如果存在关联的组件，那么不可删除，且需要弹框确认是否要删除
- 使用:
  - 禁止在使用时调整子元素结构，必须编辑原始组件才行，或者使用开发的显隐藏属性来实现
  - 禁止调整元素的位置、边距和大小，只能设置文字和效果
  - 

技术要点：

- 需要设定独立的组件绘制画布，兼容原有的页面编辑
- 通过组件属性修改子元素 VS 直接修改子元素
  - 通过组件属性修改子元素：可以实现多个子元素复用同一个属性，而且配置组件时会更加的直观和严谨，但是实现较为复杂
  - 直接修改子元素：非常灵活且直观，用户想改哪里就点哪里，
- 直接对组件元素进行修改后，如何还原组件原有的值？
  - figma：在组件的属性右上角提供扩展菜单，可以重置
  - Webflow：不支持
  - plasmic：似乎不支持定制组件，修改时会直接影响原始组件
- 如何解决组件结构调整对已有实例的影响

```typescript

```



### 样式

#### 大小输入框

- 支持多种单位切换
  如何解决切换单位时保持原有的位置和大小
- 支持响应式单位

#### 屏幕适配

业务组件内部元素的样式要如何适配不同屏幕？

- 业务组件是用 vw 或 rem 进行屏幕适配，那么要如何确保在编辑器画布和真实设备一致呢？
- - 如果业务组件按特定的设计稿适配，但和画布框架的大小不匹配，要如何适配呢？

总结：需要适配的样式统一使用 rem 单位，编辑器和运行时根据页面框架设置的屏幕大小进行适配，调整 HTML 的字体大小。

ps：如果要隔离编辑器画布的样式，可以考虑使用 iframe 来实现。

#### 组件定位

| 定位/竞品 | plasmic | webflow | 稿定 |
| --------- | ------- | ------- | ---- |
| 默认定位  | ✓       | ✓       | ✗    |
| 相对定位  | ✗       | ✓       |      |
| 自由定位  | ✓       | ✓       | ✓    |
| 粘性定位  | ✓       | ✓       | ✗    |
| 固定定位  | ✓       | ✓       | ✗    |

细节问题

- 非自由布局容器 + 非默认定位子组件：子组件是否可以拖拽

  | 定位/竞品 | plasmic                          | webflow                          | 稿定   |
  | --------- | -------------------------------- | -------------------------------- | ------ |
  | 相对定位  | 不支持                           | 不可以拖拽，需要手动调整位置属性 | 不支持 |
  | 自由定位  | 支持拖拽                         | 同上                             | 不支持 |
  | 粘性定位  | 不支持拖拽，需要手动调整位置属性 | 同上                             | 不支持 |
  | 固定定位  | 不支持拖拽，需要手动调整位置属性 | 同上                             | 不支持 |

- 

#### 样式重用

竞品分析：

| 特性/竞品 | plasmic | webflow | 稿定 |
| --------- | ------- | ------- | ---- |
| 样式重用  | ✓       | ✓       | ✗    |

功能要点：

- 管理
  - 样式列表
  - 新增/修改/复制样式
  - 查找样式引用关系
- 使用：在组件属性面板上支持关联配置重用样式
  - 按顺序迭代样式
  - 支持调整重用样式排序
  - 提供快捷按钮清除覆盖样式
  - 提供额外的按钮来提取样式作为重用样式

技术要点：

- 删除重用样式时该如何处理已关联应用的组件样式
  由于涉及到多个重用样式的叠加计算，现阶段只能忽略了。
- 在重用样式基础上自定义之后的清除和重置问题？
  - 场景一：需要在重用样式基础上微调
  - 场景二：在场景一基础上需要还原重用样式（提供清除按钮）
  - 场景三：清除掉部分重用样式

#### 样式变量

功能要点：

- 管理
  - 分组管理：根据样式类型不同进行分组管理，例如颜色变量和大小变量
    ps：plasmic 将变量划分了颜色、大小、字体类型、字体大小和行高，这些样式比较需要重用
  - 新增/修改/删除/复制样式变量：样式变量能够支持相互引用
  - 查找样式变量的引用关系：查看哪些元素在使用变量
- 使用：在对应样式输入框里支持搜索查找关联的样式变量

技术要点：

1. 要选择合适的样式类型作为变量管理
   例如：颜色、大小这样的样式适合使用变量来管理，而阴影样式这种的复杂样式，虽然可以使用变量来实现，但更建议使用样式重用来实现。
2. 要在哪些地方支持输入样式变量：特定 VS 任意
   - 特定：比较容易实现，可以忽略比边框等这样复杂样式内的变量关联，这类样式可以使用样式重用解决
   - 任意：在排查变量和属性的关联关系时叫我复杂，要考虑的场景较多
3. 在渲染的时候该如何解析样式变量？
   - CSS 变量：实现简单，但一些旧浏览器不支持
   - 自行解析：增加复杂度，且影响性能
4. 在删除样式变量的时候如何同步更新关联的样式
   如何查找？

### 资源

#### 字体

- 提取法：组件的字体样式提供所有可用的字体，运行的时候收集所有实际使用到的字体，然后插入对应的字体样式

  - 优点：操作简单，用户可以直接使用大部分字体
  - 缺点：收集逻辑较为复杂，如果遇到动态样式时难以实现

- 预设法：全局统一添加可用的字体，组件的字体样式只显示已经添加的字体，运行的时候加载预设字体节课。

  - 优点：实现简单，运行时只有加载全局配置的字体即可
  - 缺点：操作没那么快捷，用户需要预设好字体

ps：如何解决字体文件较大的问题？参照使用 google 字体的 unicode-range。

#### 国际化


1. 开发特定的国际化业务组件，只有特定组件才支持国际化，多语言的设置和渲染都交给特定业务组件处理；
2. 全局配置国际化语言，在文本输入框里输入关联标识（支持自动完成）

   - 然后在渲染的时候通过插件遍历字段来替换文案（影响性能？）

   - 所有文本渲染都交给特殊组件处理，该组件会自行格式化实现。


3. 组件属性区分多语言设置

可以解决素材、样式等国际化，但遇到复用的情况下，与无法解决配置冗余。

最终采用方案 2，文本交给特殊组件处理。

输入框组件的交互设计

- 未输入国际化信息

  - 点击打开国际化选择器
  - 选择某条国际化信息，然后更新输入信息为国际化标识符，输入框自动获取焦点
  - 选择器默认不关闭，可供二次选择，需要的话手动关闭

- 已输入国际化信息：不可输入任何信息，必须先清除国际化信息后才允许

  - 获取焦点

    - 自动打开国际化选择器
    - 可以选择切换信息

  - 清除

    - 可以选中清除
    - 清楚后自动关闭选择器

### 插件

开发二次封装使用的扩展方式。

- 如何解决编辑器不同区域快捷键冲突问题

### 扩展

类似于浏览器扩展，相对比插件更加开发和标准化。

### 协同

- [低代码多分支协同开发的建设与实践](https://mp.weixin.qq.com/s/DmwxL67htHfTUP1U966N-Q?utm_oi=35897751896064&utm_source=pocket_reader)
### 跨框架

- iframe：在 tmagic 中出现，对开发者来说使用较为复杂，但可以实现多种运行框架，而且可以较好的隔离样式和实现响应式等特性
- 其他编辑器比较少见使用 iframe 的，开发者使用起来较为简单，但缺乏对多种运行框架和响应式等特性的支持

## 参考文献

- [页面可视化搭建工具前生今世](https://github.com/CntChen/cntchen.github.io/issues/15)
- [云凤蝶可视化搭建的推导与实现](https://zhuanlan.zhihu.com/p/90746742)
- [前端可视化搭建二三事](https://github.com/SunXinFei/sunxinfei.github.io/issues/26)
- [「可视化搭建系统」——从设计到架构，探索前端的领域和意义](https://juejin.im/post/5f1e98c05188252e5522dc0c)
- [这可能是目前最好用的开源可视化拖拽框架](https://juejin.cn/post/6990000320822657031)
- [基于自然流布局的H5编辑器brick design 项目篇](https://juejin.cn/post/6883099504480878600)
- [我用 Vue +Fabric.js写了个简易的H5可视化图片编辑器](https://juejin.cn/post/6994365575027752967)
- [从零设计可视化大屏搭建引擎](https://juejin.cn/post/6981257575425654792)
- [Vue + Egg 实现一个 H5页面可视化编辑器 / 可视化配置平台](https://juejin.cn/post/7001077797808504839)
- [设计系统的未来](https://www.bilibili.com/video/BV1KG4y1x75q/?spm_id_from=333.337.search-card.all.click&vd_source=2e69ba889e556e858093542d78fc08c0) / [Subcomponents](https://medium.com/eightshapes-llc/subcomponents-753ce9f6600a)

综合

- [前端页面可视化搭建工具业界的轮子](https://juejin.cn/post/6858881797490098190) / [20+个前端可视化搭建工具，一次玩个够](https://jishuin.proginn.com/p/763bfbd52af4)
- [「可视化搭建系统」——从设计到架构，探索前端领域技术和业务价值](https://zhuanlan.zhihu.com/p/164558106)
- [页面可视化搭建工具技术要点](https://github.com/CntChen/cntchen.github.io/issues/17)
- [可视化搭建的一些思考和实践](https://mp.weixin.qq.com/s?__biz=MzU2Mzk1NzkwOA%3D%3D&chksm=fc530835cb2481233acc7ac2c856b30c7698dd9d2aec1514b5c2fa4165bc2728f7b261c4938f&idx=1&mid=2247487950&scene=21&sn=e674a2f9379b9c9b8a149498a50c17f8&utm_source=pocket_reader)
- [Spotify 如何可视化系统架构图](https://www.infoq.cn/article/s5UwbP01ga8akJIFgtZV?utm_source=pocket_saves)
- [基于 React 的可视化编辑平台实践](https://zhuanlan.zhihu.com/p/94016600?utm_oi=35897751896064&utm_source=pocket_reader)
- [技术周报· 基于设计稿识别的可视化低代码系统实践](https://mp.weixin.qq.com/s/JUXz9TOKbkO1oAzHjVfwnQ)
- [可视化拖拽组件库一些技术要点原理分析](https://github.com/woai3c/Front-end-articles/issues/19)

  - [可视化拖拽组件库一些技术要点原理分析（二）](https://github.com/woai3c/Front-end-articles/issues/20)
  - [可视化拖拽组件库一些技术要点原理分析（三）](https://github.com/woai3c/Front-end-articles/issues/21)
  - [可视化拖拽组件库一些技术要点原理分析（四）](https://segmentfault.com/a/1190000042282658)

画布

- [浅谈搭建平台 - 画布篇](https://mp.weixin.qq.com/s/pfWplWHajZDcsOH_m3rUMw)
- [可视化搭建平台之跨iframe拖拽](https://zhuanlan.zhihu.com/p/353043053?utm_oi=35897751896064&utm_source=pocket_reader)

数据

- [如何设计实现 h5 页面搭建-数据模型](https://mp.weixin.qq.com/s/Fyl3SMHjv3ROw9QUBdwutA?utm_source=pocket_reader)

案例

- [美团外卖前端可视化界面组装平台 —— 乐高](https://zhuanlan.zhihu.com/p/27288444?utm_source=pocket_reader)
- [我在闲鱼做搭建——魔鱼搭投编辑器介绍](https://zhuanlan.zhihu.com/p/538265765?utm_oi=35897751896064&utm_source=pocket_reader)
- [从零开发一款图片编辑器Mitu-Dooring](https://mp.weixin.qq.com/s/SEIgiDJZOCX11JqxFdiKUw)
- [我也做了一个可视化H5编辑器](https://juejin.cn/post/6919347925860499463)
- [可视化搭建移动端店铺解决方案](https://mp.weixin.qq.com/s?__biz=MzU2Mzk1NzkwOA%3D%3D&chksm=fc530e9acb24878c90ce680610dd0a339dccdf2e04aea0ef815b71178c137032c3f8afbfa02a&cur_album_id=1885104505269108738&idx=1&mid=2247489377&scene=189&sn=2f205a9519c8f0e391f1e7473851153d&utm_source=pocket_saves)
- [凹凸技术揭秘·羚珑页面可视化·成长蜕变之路](https://segmentfault.com/a/1190000038792146)
- [从零开发一款图片编辑器Mitu-Dooring](https://mp.weixin.qq.com/s/SEIgiDJZOCX11JqxFdiKUw)

开源

- [rxeditor](https://github.com/rxdrag/rxeditor)

讨论

- [我做了一个 HTML 可视化编辑工具，有前途吗？](https://www.zhihu.com/question/390956688/answer/1184696066?utm_oi=35897751896064&utm_source=pocket_reader)
